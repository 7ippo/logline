/*!
 * logline v1.0.2 (https://github.com/latel/logline#readme)
 * Copyright 2016, latel <latelx64@gmail.com>
 * MIT license
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Logline=t():e.Logline=t()}(this,function(){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),i=o(1),c=n(i),l=o(5),s=n(l),f=o(6),p=n(f),d=o(3),_=r(d),y=function(){function e(t){return a(this,e),e._checkProtocol(),new e._protocol(t)}return u(e,null,[{key:"_initProtocol",value:function(t){e._protocol=t,e._protocol.init(e._database||"logline")}},{key:"_checkProtocol",value:function(){if(!e._protocol){for(var t=Object.keys(e.PROTOCOL),o=void 0;o=e.PROTOCOL[t.shift()];)if(o.support)return void e._initProtocol(o);throw new Error(t.join(", ").toLowerCase()+" protocols are not supported on this platform")}}},{key:"getAll",value:function(t){e._checkProtocol(),e._protocol.all(function(e){return t(e)})}},{key:"keep",value:function(t){return e._checkProtocol(),e._protocol.keep(t),this}},{key:"clean",value:function(){return e._checkProtocol(),e._protocol.clean(),this}},{key:"using",value:function(t,o){return-1===[c["default"],s["default"],p["default"]].indexOf(t)&&_.throwError("specialfied protocol "+(t?t+" ":"")+"is not available"),e._protocol?this:(e.database(o||e._database),e._initProtocol(t),this)}},{key:"database",value:function(t){e._database=t}}]),e}();y.PROTOCOL={INDEXEDDB:c["default"],WEBSQL:s["default"],LOCALSTORAGE:p["default"]},e.exports=y},function(e,t,o){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),l=function b(e,t,o){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var n=Object.getPrototypeOf(e);return null===n?void 0:b(n,t,o)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(o)},s=o(2),f=n(s),p=o(4),d=n(p),_=o(3),y=r(_),v=function(e){function t(){var e;a(this,t);for(var o=arguments.length,r=Array(o),n=0;n<o;n++)r[n]=arguments[n];return u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)))}return i(t,e),c(t,[{key:"_record",value:function(e,o,r){var n=this;if(t.status!==f["default"].STATUS.INITED)return t._pool.push(function(){n._record(e,o,r)}),void(t.status!==f["default"].STATUS.INITING&&t.init());var a=t.db.transaction(["logs"],IDBTransaction.READ_WRITE||"readwrite");a.onerror=function(e){return y.throwError(e.target.error)};var u=a.objectStore("logs"),i=u.add({time:Date.now(),namespace:this._namesapce,descriptor:o,data:r});i.onerror=function(e){t.status=f["default"].STATUS.FAILED,y.throwError(e.target.error)}}}],[{key:"init",value:function(e){var o=this;return t.support||y.throwError("your platform does not support indexeddb protocol."),!t.status&&(t._pool=t._pool||new d["default"],t._database=e||"logline",t.status=l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITING,t.request=window.indexedDB.open(t._database),t.request.onerror=function(e){return y.throwError("protocol indexeddb is prevented.")},t.request.onsuccess=function(e){t.db=e.target.result,t.status=l(t.__proto__||Object.getPrototypeOf(t),"STATUS",o).INITED,t._pool.consume(),t.db.onerror=function(e){return y.throwError(e.target.error)}},void(t.request.onupgradeneeded=function(e){var t=e.target.result,o=t.createObjectStore("logs",{autoIncrement:!0});o.createIndex("namespace","namespace",{unique:!1}),o.createIndex("level","level",{unique:!1}),o.createIndex("descriptor","descriptor",{unique:!1}),o.createIndex("data","data",{unique:!1})}))}},{key:"all",value:function(e){if(t.status!==l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITED)return void t._pool.push(function(){t.all(e)});var o=t._getTransactionStore(IDBTransaction.READ_ONLY||"readonly"),r=o.openCursor(),n=[];r.onsuccess=function(t){var o=t.target.result;console&&console.log(o),o?(n.push({time:o.value.time,namespace:o.value.namespace,descriptor:o.value.descriptor,data:o.value.data}),o["continue"]()):e(n)},r.onerror=function(e){return y.throwError("failed to literat on logs from database.")}}},{key:"keep",value:function(e){if(t.status!==l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITED)return void t._pool.push(function(){t.keep(e)});var o=t._getTransactionStore(IDBTransaction.READ_WRITE);if(e){var r=IDBKeyRange.upperBound(Date.now()-24*(e||2)*3600*1e3,!0),n=o.openCursor(r);n.onsuccess=function(e){var t=e.target.result;t&&(o["delete"](t.primaryKey),t["continue"]())},n.onerror=function(t){return y.throwError("unable to locate logs earlier than "+e+"d.")}}else{o.clear().onerror=function(e){return y.throwError(e.target.error)}}}},{key:"clean",value:function(){if(t.status!==l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITED)return void t._pool.push(function(){t.clean()});t.db.close();var e=window.indexedDB.deleteDatabase(t._database);e.onerror=function(e){return y.throwError(e.target.error)},e.onsuccess=function(e){delete t.status,delete t.db}}},{key:"_getTransactionStore",value:function(e){if(t.db){var o=t.db.transaction(["logs"],e||IDBTransaction.READ_WRITE||"readwrite");return o.onerror=function(e){return y.throwError(e.target.error)},o.objectStore("logs")}y.throwError("log database is not created or connections is closed, considering init it.")}}]),t}(f["default"]);t["default"]=v,v.support=!!(window.indexedDB&&window.IDBTransaction&&window.IDBKeyRange)},function(e,t,o){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),u=o(3),i=r(u),c=function(){function e(t){n(this,e),this._namesapce=t}return a(e,[{key:"_record",value:function(e,t,o){i.throwError("method _record is not implemented.")}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];this._record.apply(this,["info"].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];this._record.apply(this,["warn"].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];this._record.apply(this,["error"].concat(t))}},{key:"critical",value:function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];this._record.apply(this,["critical"].concat(t))}}],[{key:"init",value:function(e){e()}},{key:"all",value:function(e){e([])}},{key:"keep",value:function(){}},{key:"clean",value:function(){}},{key:"STATUS",get:function(){return{INITING:1,INITED:2,FAILED:4}}}]),e}();t["default"]=c},function(e,t){"use strict";function o(e){throw new Error("Logline: "+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.throwError=o},function(e,t){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),n=function(){function e(){o(this,e),this._pool=[]}return r(e,[{key:"push",value:function(e,t){e.context=t,this._pool.push(e)}},{key:"consume",value:function(){for(var e;e=this._pool.shift();)e.call(e.context)}}]),e}();t["default"]=n},function(e,t,o){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),l=function b(e,t,o){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var n=Object.getPrototypeOf(e);return null===n?void 0:b(n,t,o)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(o)},s=o(2),f=n(s),p=o(4),d=n(p),_=o(3),y=r(_),v=function(e){function t(){var e;a(this,t);for(var o=arguments.length,r=Array(o),n=0;n<o;n++)r[n]=arguments[n];return u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)))}return i(t,e),c(t,[{key:"_record",value:function(e,o,r){var n=this;if(t.status!==f["default"].STATUS.INITED)return t._pool.push(function(){n._record(e,o,r)}),void(t.status!==f["default"].STATUS.INITING&&t.init());try{t._db.transaction(function(t){t.executeSql("INSERT INTO logs (time, namespace, level, descriptor, data) VALUES(?, ?, ?, ? ,?)",[Date.now(),n._namesapce,e,o,void 0===r||""===r?"":JSON.stringify(r)||""],function(){},function(e,t){throw t.message})})}catch(a){y.throwError("error inserting record")}}}],[{key:"init",value:function(e){var o=this;if(t.support||y.throwError(new Error("your platform does not support websql protocol.")),t.status)return!1;t._pool=t._pool||new d["default"],t._database=e||"logline",t.status=l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITING;try{t._db=window.openDatabase(t._database,"1.0","cats loves logs",5085593.6),t._db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS logs (time, namespace, level, descriptor, data)",[],function(){t.status=l(t.__proto__||Object.getPrototypeOf(t),"STATUS",o).INITED,t._pool.consume()},function(){t.status=l(t.__proto__||Object.getPrototypeOf(t),"STATUS",o).FAILED})})}catch(r){y.throwError("unable to init log database.")}}},{key:"all",value:function(e){if(t.status!==l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITED)return void t._pool.push(function(){t.all(e)});try{t._db.transaction(function(t){t.executeSql("SELECT * FROM logs ORDER BY time DESC",[],function(t,o){for(var r,n=[],a=o.rows.length;--a>=0;)r=JSON.parse(JSON.stringify(o.rows.item(a))),r.data=JSON.parse(r.data),n.push(r);e(n)},function(e,t){throw t.message})})}catch(o){y.throwError("unable to collect logs from database.")}}},{key:"keep",value:function(e){if(t.status!==l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITED)return void t._pool.push(function(){t.keep(e)});try{t._db.transaction(function(t){e?t.executeSql("DELETE FROM logs WHERE time < ?",[Date.now()-24*(e||2)*3600*1e3],function(){},function(e,t){throw t.message}):t.executeSql("DELETE FROM logs",[],function(){},function(e,t){throw t.message})})}catch(o){y.throwError("unable to clean logs from database.")}}},{key:"clean",value:function(){if(t.status!==l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITED)return void t._pool.push(function(){t.clean()});try{t._db.transaction(function(e){e.executeSql("DROP TABLE logs",[],function(){delete t.status},function(e,t){throw t.message})})}catch(e){y.throwError("unable to clean log database.")}}}]),t}(f["default"]);t["default"]=v,v.support="openDatabase"in window},function(e,t,o){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),l=function y(e,t,o){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var n=Object.getPrototypeOf(e);return null===n?void 0:y(n,t,o)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(o)},s=o(2),f=n(s),p=o(3),d=r(p),_=function(e){function t(){var e;a(this,t);for(var o=arguments.length,r=Array(o),n=0;n<o;n++)r[n]=arguments[n];return u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)))}return i(t,e),c(t,[{key:"_record",value:function(e,o,r){var n=window.localStorage.getItem(t._database)?JSON.parse(window.localStorage.getItem(t._database)):[];n.push({time:Date.now(),namespace:this._namesapce,level:e,descriptor:o,data:r});try{window.localStorage.setItem(t._database,JSON.stringify(n))}catch(a){d.throwError("error inserting record")}}}],[{key:"init",value:function(e){t.support||d.throwError("your platform does not support localstorage protocol."),t._database=e||"logline",window.localStorage.getItem(t._database)||window.localStorage.setItem(t._database,JSON.stringify([])),t.status=l(t.__proto__||Object.getPrototypeOf(t),"STATUS",this).INITED}},{key:"all",value:function(e){e(JSON.parse(window.localStorage.getItem(t._database)))}},{key:"keep",value:function(e){var o=e?(window.localStorage.getItem(t._database)?JSON.parse(window.localStorage.getItem(t._database)):[]).filter(function(t){return t.time>=Date.now()-24*(e||2)*3600*1e3}):[];window.localStorage.setItem(t._database,JSON.stringify(o))}},{key:"clean",value:function(){delete t.status,window.localStorage.removeItem(t._database)}}]),t}(f["default"]);t["default"]=_,f["default"].support="localStorage"in window}])});
//# sourceMappingURL=logline.min.map